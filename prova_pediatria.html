<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resolvedor de Questões Interativo - Pediatria</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-bg: #f7fafc; /* gray-100 */
            --secondary-bg: white;
            --text-primary: #2d3748; /* gray-800 */
            --text-secondary: #4a5568; /* gray-700 */
            --border-color: #d2d6dc; /* gray-300 */
            --accent-color: #4299e1; /* blue-500 */
            --correct-bg: #c6f6d5; /* green-200 */
            --correct-border: #38a169; /* green-600 */
            --incorrect-bg: #fed7d7; /* red-200 */
            --incorrect-border: #e53e3e; /* red-600 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            --primary-bg: #1a202c; /* gray-900 */
            --secondary-bg: #2d3748; /* gray-800 */
            --text-primary: #e2e8f0; /* gray-200 */
            --text-secondary: #a0aec0; /* gray-500 */
            --border-color: #4a5568; /* gray-600 */
        }
        .question-block {
            background-color: var(--secondary-bg);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--border-color);
        }
        .option-button {
            display: flex;
            align-items: center;
            width: 100%;
            text-align: left;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            background-color: var(--secondary-bg);
            transition: background-color 0.2s, border-color 0.2s;
            cursor: pointer;
        }
        .option-button:hover:not(:disabled) {
            background-color: var(--primary-bg);
        }
        .option-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }
        .option-letter {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            margin-right: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .correct-option {
            background-color: var(--correct-bg) !important;
            border-color: var(--correct-border) !important;
            color: var(--correct-border) !important;
        }
        .correct-option .option-letter {
            background-color: var(--correct-border);
            color: white;
            border-color: var(--correct-border);
        }
        .incorrect-option {
            background-color: var(--incorrect-bg) !important;
            border-color: var(--incorrect-border) !important;
            color: var(--incorrect-border) !important;
        }
        .incorrect-option .option-letter {
            background-color: var(--incorrect-border);
            color: white;
            border-color: var(--incorrect-border);
        }
        .explanation-box {
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--primary-bg);
            border-left: 4px solid var(--accent-color);
            border-radius: 0.25rem;
        }
        .sticky-header {
            position: sticky;
            top: 0;
            background-color: rgba(247, 250, 252, 0.95); /* gray-100 with opacity */
            z-index: 50; /* Increased z-index */
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        body.dark-mode .sticky-header {
            background-color: rgba(26, 32, 44, 0.95); /* gray-900 with opacity */
        }
        .control-button {
            background-color: var(--accent-color);
            color: white;
        }
        .control-button:hover {
            background-color: #2b6cb0; /* blue-600 */
        }
        .tab-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: 1px solid transparent;
            font-weight: 500;
        }
        .tab-button.active {
            background-color: var(--accent-color);
            color: white;
        }
        .tab-button:not(.active) {
            color: var(--text-secondary);
            border-color: var(--border-color);
        }
        body.dark-mode .tab-button:not(.active) {
            color: var(--text-primary);
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            background-color: var(--secondary-bg);
            margin: 10% auto;
            padding: 2rem;
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 500px;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .modal-close {
            color: var(--text-secondary);
            float: right;
            font-size: 1.75rem;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-close:hover,
        .modal-close:focus {
            color: var(--text-primary);
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div class="container mx-auto max-w-4xl p-4">

        <div class="sticky-header">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl sm:text-2xl font-bold text-blue-700">Resolvedor de Questões: Pediatria</h1>
                <button id="themeToggleBtn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                    <i class="fas fa-moon"></i> <i class="fas fa-sun" style="display:none;"></i> </button>
            </div>

            <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                <div class="flex space-x-2">
                    <button id="studyModeBtn" class="tab-button active">Modo Estudo</button>
                    <button id="examModeBtn" class="tab-button">Modo Simulado</button>
                </div>
                <div class="text-md font-semibold">
                    Pontuação: <span id="scoreCounter" class="text-green-600">0</span>/<span id="answeredCounter">0</span>
                    (Total Visíveis: <span id="visibleQuestionsCounter">0</span>)
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label for="topicFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Filtrar por Tópico:</label>
                    <select id="topicFilter" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option value="all">Todos os Tópicos</option>
                        </select>
                </div>
                <div>
                    <label for="searchInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Buscar Questão:</label>
                    <input type="text" id="searchInput" placeholder="Digite palavras-chave..." class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
                <div id="examModeControls" style="display:none;">
                     <label for="numQuestionsExam" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Nº de Questões (Simulado):</label>
                    <input type="number" id="numQuestionsExam" value="10" min="1" class="mt-1 block w-full py-2 px-3 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                </div>
            </div>
             <div class="flex justify-between items-center mb-2" id="navigationContainer" style="display:none;">
                <button id="prevQuestionBtn" class="control-button py-2 px-4 rounded-md text-sm"><i class="fas fa-arrow-left mr-1"></i> Anterior</button>
                <span id="timer" class="text-lg font-semibold">Tempo: 00:00</span>
                <button id="nextQuestionBtn" class="control-button py-2 px-4 rounded-md text-sm">Próxima <i class="fas fa-arrow-right ml-1"></i></button>
            </div>
            <div id="examProgress" class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-4" style="display:none;">
                <div id="examProgressBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
        </div>

        <div id="quizContainer" class="mt-6">
            </div>

        <div id="examSummaryContainer" class="mt-8" style="display:none;">
            <h2 class="text-2xl font-bold mb-4 text-center">Resultado do Simulado</h2>
            <p class="text-lg text-center">Acertos: <span id="examScore" class="font-bold text-green-600">0</span> de <span id="examTotal" class="font-bold">0</span></p>
            <p class="text-lg text-center mb-2">Tempo Gasto: <span id="examTimeSpent" class="font-bold">00:00</span></p>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-6">
                <button id="reviewExamBtn" class="control-button py-2 px-6 rounded-md">Revisar Gabarito</button>
                <button id="retryIncorrectBtn" class="bg-orange-500 hover:bg-orange-600 text-white py-2 px-6 rounded-md">Refazer Erradas</button>
                <button id="restartExamBtn" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-6 rounded-md">Novo Simulado</button>
            </div>
        </div>
        
        <div id="historyModal" class="modal">
            <div class="modal-content">
                <span class="modal-close" onclick="document.getElementById('historyModal').style.display='none'">&times;</span>
                <h2 class="text-xl font-semibold mb-4">Histórico de Simulados</h2>
                <div id="historyList" class="text-left max-h-80 overflow-y-auto"></div>
                <button id="clearHistoryBtn" class="mt-4 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-md text-sm">Limpar Histórico</button>
            </div>
        </div>
        <button id="showHistoryBtn" class="fixed bottom-4 right-4 control-button p-3 rounded-full shadow-lg" title="Ver Histórico">
            <i class="fas fa-history"></i>
        </button>

    </div>

    <script>
        // Array de questões (COMPLETO COM 50 QUESTÕES)
        const allQuestions = [
            // Questão 1
            {
                id: 1,
                question: "1. Paciente, 6 anos, apresenta-se com rinorreia purulenta persistente e tosse diurna há 12 dias, sem melhora. A febre foi baixa e intermitente nos primeiros dias, mas ausente nos últimos 5 dias. Qual o critério diagnóstico para Rinossinusite Bacteriana Aguda (RBA) mais provável neste caso, segundo a Academia Americana de Pediatria, e qual a conduta inicial recomendada?",
                options: [
                    "Sintomas graves (febre alta ≥39°C e secreção purulenta por ≥3 dias); iniciar amoxicilina-clavulanato.",
                    "Sintomas persistentes (secreção nasal e/ou tosse diurna por >10 dias sem melhora); iniciar amoxicilina.",
                    "Piora do quadro (após melhora inicial de um resfriado comum); iniciar cefuroxima.",
                    "Rinossinusite viral prolongada; manter observação e sintomáticos."
                ],
                answer: 1,
                explanation: "O paciente apresenta sintomas (rinorreia e tosse) por 12 dias sem melhora, o que se enquadra no critério de \"sintomas persistentes\" para RBA. A febre não é um componente obrigatório deste critério se os outros sintomas nasais/tosse persistirem. A amoxicilina é a primeira escolha.",
                topic: "Afecções VAS",
                reference: "Aula Afecções VAS, slide 16"
            },
            // Questão 2
            {
                id: 2,
                question: "2. Lactente de 9 meses é levado à consulta com história de otalgia intensa há 24 horas, febre de 39,2°C e recusa alimentar. À otoscopia, observa-se membrana timpânica abaulada e hiperemiada em orelha direita, sem otorreia. Qual a conduta mais apropriada, considerando a idade e a gravidade dos sintomas?",
                options: [
                    "Observação inicial por 48-72h, com analgesia.",
                    "Iniciar antibioticoterapia com amoxicilina (dose padrão).",
                    "Iniciar antibioticoterapia com amoxicilina (dose alta: 80-90mg/kg/dia).",
                    "Solicitar timpanocentese para cultura antes de iniciar antibiótico."
                ],
                answer: 2,
                explanation: "Em lactentes de 6 meses a 2 anos com OMA e sintomas graves (otalgia intensa, febre ≥39°C), a antibioticoterapia está recomendada. Algumas diretrizes, como as citadas no material (\"Nelson - Tratado de Pediatria\"), recomendam a dose alta de amoxicilina (80-90mg/kg/dia) para cobrir possível resistência do pneumococo, especialmente em quadros mais graves.",
                topic: "Afecções VAS",
                reference: "Aula Afecções VAS, slide 25-26"
            },
            // Questão 3
            {
                id: 3,
                question: "3. Escolar de 7 anos apresenta odinofagia de início abrupto, febre de 38,5°C, ausência de tosse, linfonodomegalia cervical anterior dolorosa e exsudato amigdaliano. Utilizando o Escore de Centor Modificado, qual seria a pontuação e a conduta recomendada no Brasil, dada a prevalência de febre reumática?",
                options: [
                    "Escore 2; tratar apenas se teste rápido para Estreptococo do Grupo A (EBHGA) for positivo.",
                    "Escore 3; considerar cultura de orofaringe e tratar se positiva.",
                    "Escore 4; iniciar tratamento empírico para EBHGA com penicilina ou amoxicilina.",
                    "Escore 1; apenas tratamento sintomático."
                ],
                answer: 2,
                explanation: "Pontuação: Febre >38°C (+1), Ausência de tosse (+1), Linfonodomegalia cervical anterior dolorosa (+1), Edema ou exsudato tonsilar (+1). Total = 4 pontos. Com escore ≥2, no Brasil, devido à prevalência de febre reumática, o tratamento é recomendado. Com escore 4, o risco de infecção por S. pyogenes é alto (51-53%), justificando o tratamento empírico.",
                topic: "Afecções VAS",
                reference: "Aula Doenças Respiratórias Infância, slide 30"
            },
            // Questão 4
            {
                id: 4,
                question: "4. Um lactente de 4 meses, nascido prematuro com 30 semanas e com diagnóstico de displasia broncopulmonar, está no período de sazonalidade do Vírus Sincicial Respiratório (VSR). Qual a principal medida profilática específica para VSR indicada para este paciente?",
                options: [
                    "Vacinação anual contra influenza.",
                    "Administração de corticoide inalatório diário.",
                    "Uso de Palivizumabe mensalmente durante a sazonalidade do VSR.",
                    "Antibioticoprofilaxia com azitromicina."
                ],
                answer: 2,
                explanation: "O Palivizumabe é um anticorpo monoclonal indicado para profilaxia de doença grave pelo VSR em grupos de alto risco, que incluem prematuros ≤28 semanas com idade inferior a 1 ano e crianças <2 anos com doença pulmonar crônica da prematuridade (displasia broncopulmonar) ou cardiopatia congênita com repercussão hemodinâmica.",
                topic: "Bronquiolite",
                reference: "Aula Bronquiolite, slide 7"
            },
            // Questão 5
            {
                id: 5,
                question: "5. Paciente de 3 anos é internado com diagnóstico de pneumonia grave, apresentando taquipneia, tiragem subcostal e SatO2 de 88% em ar ambiente. Qual o esquema antibiótico endovenoso de primeira escolha recomendado pelas diretrizes brasileiras para esta faixa etária?",
                options: [
                    "Amoxicilina oral.",
                    "Azitromicina endovenosa.",
                    "Ampicilina ou Penicilina G Cristalina endovenosa.",
                    "Vancomicina associada a Meropenem."
                ],
                answer: 2,
                explanation: "Para pneumonia grave em lactentes e pré-escolares (>2 meses até 5 anos) que necessitam de internação, a primeira opção de antibioticoterapia endovenosa é Ampicilina ou Penicilina G Cristalina.",
                topic: "Pneumonia",
                reference: "Aula Bronquiolite (inclui Pneumonia), slide 16"
            },
            // Questão 6
            {
                id: 6,
                question: "6. Criança de 6 anos, asmática, utiliza corticoide inalatório em dose baixa associado a beta-2 agonista de longa duração (LABA) para controle da doença e raramente necessita de medicação de resgate. Como é classificada a gravidade da asma desta criança?",
                options: ["Leve.", "Moderada.", "Grave.", "Intermitente."],
                answer: 1,
                explanation: "A classificação de gravidade da asma é avaliada retrospectivamente. Uma asma bem controlada com dose baixa ou moderada de corticoide inalatório associado a um beta-2-agonista de longa ação (LABA) é classificada como asma moderada.",
                topic: "Asma",
                reference: "Aula Afecções VAI, slide 6"
            },
            // Questão 7
            {
                id: 7,
                question: "7. No manejo da crise de asma leve a moderada em domicílio, qual a recomendação para um adolescente de 14 anos que utiliza a terapia de alívio e anti-inflamatória (MART - Maintenance and Reliever Therapy)?",
                options: ["Utilizar Salbutamol spray 4-10 jatos a cada 20 minutos na primeira hora.", "Utilizar a combinação de Formoterol e corticoide inalatório extra sob demanda, até a dose máxima diária de Formoterol permitida.", "Iniciar Prednisona oral imediatamente.", "Procurar emergência apenas se houver cianose."],
                answer: 1,
                explanation: "A terapia MART (Maintenance and Reliever Therapy) utiliza uma combinação de corticoide inalatório (CI) e Formoterol (um LABA de início rápido) tanto para manutenção quanto para alívio dos sintomas. Em crise, o paciente aumenta as doses do seu dispositivo único conforme necessário.",
                topic: "Asma",
                reference: "Aula Afecções VAI, slide 11"
            },
            // Questão 8
            {
                id: 8,
                question: "8. Paciente de 10 anos, com história de alergia a amendoim, ingere acidentalmente um alimento contendo o alérgeno. Em poucos minutos, desenvolve urticária generalizada, angioedema de lábios e língua, dispneia com sibilos e hipotensão. Qual a conduta imediata prioritária?",
                options: ["Administrar anti-histamínico endovenoso.", "Administrar corticoide oral em dose alta.", "Administrar adrenalina intramuscular na face anterolateral da coxa.", "Realizar nebulização com broncodilatador."],
                answer: 2,
                explanation: "A anafilaxia é uma emergência médica. A adrenalina intramuscular é o tratamento de primeira linha e deve ser administrada imediatamente.",
                topic: "Anafilaxia",
                reference: "Aula Anafilaxia, slide 28"
            },
            // Questão 9
            {
                id: 9,
                question: "9. Qual o principal objetivo do tratamento da anemia ferropriva, além da correção dos níveis de hemoglobina?",
                options: ["Aumentar a absorção de vitamina B12.", "Repor as reservas de ferro do organismo.", "Estimular a produção de eritropoetina.", "Reduzir a sobrecarga de ferro tecidual."],
                answer: 1,
                explanation: "O tratamento da anemia ferropriva visa não apenas normalizar os níveis de hemoglobina, mas também, e fundamentalmente, repor os estoques corporais de ferro (ferritina).",
                topic: "Anemia Ferropriva",
                reference: "Aula Deficiência de Ferro, slide 18"
            },
            // Questão 10
            {
                id: 10,
                question: "10. Criança de 2 anos está em tratamento para anemia ferropriva com sulfato ferroso oral. Após 30 dias de tratamento, o hemograma mostra aumento da hemoglobina em 0,5 g/dL. Qual a conduta mais adequada?",
                options: ["Manter a dose e reavaliar em mais 30 dias, pois a resposta é lenta.", "Suspender o tratamento, pois a resposta foi inadequada.", "Investigar outras causas de anemia, falta de adesão, dose inadequada ou má absorção, pois se espera um aumento de pelo menos 1,0 g/dL.", "Aumentar a dose do sulfato ferroso para o dobro."],
                answer: 2,
                explanation: "Espera-se uma melhora nos níveis de reticulócitos e um aumento da hemoglobina em pelo menos 1,0 g/dL após 30 a 60 dias do início do tratamento adequado para anemia ferropriva. Uma resposta inferior a essa requer investigação.",
                topic: "Anemia Ferropriva",
                reference: "Aula Deficiência de Ferro, slide 19"
            },
            // Questão 11
            {
                id: 11,
                question: "11. De acordo com o Programa Nacional de Suplementação de Ferro, qual a recomendação para recém-nascidos prematuros com peso entre 1.000g e 1.500g?",
                options: [
                    "1 mg de ferro elementar/kg/dia, iniciando aos 90 dias de vida.",
                    "2 mg de ferro elementar/kg/dia, iniciando com 30 dias de vida, durante um ano, seguido por 1 mg/kg/dia por mais um ano.",
                    "3 mg de ferro elementar/kg/dia, iniciando com 30 dias de vida, durante um ano, seguido por 1 mg/kg/dia por mais um ano.",
                    "Não necessitam de suplementação se receberem fórmula infantil fortificada."
                ],
                answer: 2,
                explanation: "Para recém-nascidos prematuros com peso entre 1.000g e 1.500g, a recomendação de suplementação profilática é de 3 mg de ferro elementar/kg/dia, iniciando com 30 dias de vida, durante um ano, e após este prazo, 1 mg/kg/dia por mais um ano.",
                topic: "Anemia Ferropriva",
                reference: "Aula Deficiência de Ferro, slide 25"
            },
            // Questão 12
            {
                id: 12,
                question: "12. Lactente de 6 meses apresenta pápulas eritematosas pruriginosas no pescoço e tronco superior durante um período de muito calor e sudorese. As lesões são inflamatórias. Qual o tipo de miliária mais provável?",
                options: [
                    "Miliária cristalina.",
                    "Miliária rubra.",
                    "Miliária profunda.",
                    "Miliária pustulosa."
                ],
                answer: 1,
                explanation: "A miliária rubra é caracterizada por lesões eritematosas (avermelhadas), pruriginosas e inflamatórias, devido à obstrução mais profunda dos ductos sudoríparos.",
                topic: "Dermatologia Pediátrica",
                reference: "Aula Problemas Pele I, slide 6"
            },
            // Questão 13
            {
                id: 13,
                question: "13. Um bebê de 8 meses apresenta dermatite de fralda com eritema intenso, brilhante, e lesões papulopustulosas satélites que acometem as pregas cutâneas. Qual o tratamento tópico mais indicado para essa complicação?",
                options: [
                    "Creme de hidrocortisona a 1%.",
                    "Pomada de óxido de zinco.",
                    "Creme antifúngico (nistatina ou miconazol).",
                    "Pomada antibiótica (mupirocina)."
                ],
                answer: 2,
                explanation: "A presença de eritema intenso com lesões satélites papulopustulosas, especialmente acometendo pregas, é altamente sugestiva de infecção secundária por Candida albicans na dermatite de fraldas. O tratamento requer um antifúngico tópico.",
                topic: "Dermatologia Pediátrica",
                reference: "Aula Problemas Pele I, slide 18 (tabela)"
            },
            // Questão 14
            {
                id: 14,
                question: "14. Criança de 4 anos apresenta múltiplas lesões vesiculares e bolhosas em pele previamente normal, localizadas no tronco e membros, com conteúdo seroso que ao secar forma crostas finas. Qual o diagnóstico mais provável?",
                options: [
                    "Impetigo crostoso (não bolhoso).",
                    "Impetigo bolhoso.",
                    "Dermatite seborreica.",
                    "Molusco contagioso."
                ],
                answer: 1,
                explanation: "O impetigo bolhoso é caracterizado pelo surgimento de vesículas e bolhas em pele aparentemente normal, com conteúdo seroso que, ao secar, forma crostas finas. É causado por cepas de Staphylococcus aureus produtoras de toxina esfoliativa.",
                topic: "Dermatologia Pediátrica",
                reference: "Aula Problemas Pele I, slide 23"
            },
            // Questão 15
            {
                id: 15,
                question: "15. Qual a principal característica histopatológica da Síndrome Alcoólica Fetal (SAF) que contribui para as dismorfias faciais e alterações do SNC?",
                options: [
                    "Hiperplasia celular generalizada.",
                    "Defeitos na migração neuronal e morte celular programada aumentada.",
                    "Acúmulo de glicogênio nos tecidos fetais.",
                    "Vasculite placentária crônica."
                ],
                answer: 1,
                explanation: "O álcool etílico atravessa a barreira placentária e a barreira hematoencefálica fetal, causando danos ao SNC por múltiplos mecanismos, incluindo interferência na proliferação e migração neuronal, diferenciação celular, sinaptogênese e aumento da apoptose (morte celular programada).",
                topic: "Teratogênese",
                reference: "Aula Efeitos do Álcool RN, pág. 372"
            },
            // Questão 16
            {
                id: 16,
                question: "16. Em um paciente pediátrico com insuficiência respiratória aguda (IRPA) e hipoxemia, qual a relação gasométrica utilizada para classificar a gravidade da hipoxemia segundo a definição de Berlim para SDRA?",
                options: [
                    "Relação SatO2/FiO2.",
                    "Relação PaO2/FiO2.",
                    "Gradiente alvéolo-arterial de oxigênio.",
                    "Pressão parcial de CO2 (PaCO2)."
                ],
                answer: 1,
                explanation: "A relação entre a pressão parcial de oxigênio no sangue arterial (PaO2) e a fração inspirada de oxigênio (FiO2) é um dos principais critérios para definir e classificar a gravidade da Síndrome do Desconforto Respiratório Agudo (SDRA) e da hipoxemia.",
                topic: "Insuficiência Respiratória",
                reference: "Doc. Terapia IRpA, pág. 4 (Monitorização da oxigenação)"
            },
            // Questão 17
            {
                id: 17,
                question: "17. Paciente de 8 anos desenvolve hematúria macroscópica, edema facial e hipertensão arterial duas semanas após um episódio de piodermite. A dosagem de complemento sérico revela C3 baixo e C4 normal. Qual o achado característico na microscopia eletrônica da biópsia renal na Glomerulonefrite Pós-Estreptocócica (GNPE)?",
                options: [
                    "Espessamento difuso da membrana basal glomerular.",
                    "Depósitos subepiteliais eletrodensos (\"humps\" ou \"gibas\").",
                    "Proliferação mesangial com depósitos de IgA.",
                    "Formação de crescentes em mais de 50% dos glomérulos."
                ],
                answer: 1,
                explanation: "Na Glomerulonefrite Pós-Estreptocócica (GNPE), a microscopia eletrônica caracteristicamente revela depósitos eletrodensos subepiteliais, conhecidos como \"humps\" ou \"gibas\", que correspondem a imunocomplexos.",
                topic: "Nefropatias",
                reference: "Aula Nefropatia, slide 17"
            },
            // Questão 18
            {
                id: 18,
                question: "18. Na Síndrome Nefrótica, a perda maciça de proteínas na urina leva a diversas consequências. Qual das seguintes proteínas, quando perdida em excesso, contribui para o estado de hipercoagulabilidade?",
                options: [
                    "Albumina.",
                    "Imunoglobulinas.",
                    "Antitrombina III.",
                    "Transferrina."
                ],
                answer: 2,
                explanation: "Na Síndrome Nefrótica, a perda urinária de proteínas como a antitrombina III (um anticoagulante natural) contribui para o estado de hipercoagulabilidade e aumento do risco de eventos trombóticos.",
                topic: "Nefropatias",
                reference: "Aula Nefropatia, slide 27"
            },
            // Questão 19
            {
                id: 19,
                question: "19. Uma menina de 5 anos é diagnosticada com Puberdade Precoce Central (PPC). Qual o principal benefício esperado com o tratamento com análogos do GnRH?",
                options: [
                    "Aceleração da maturação óssea para atingir a altura final mais rapidamente.",
                    "Indução da menarca para regularizar o ciclo menstrual.",
                    "Supressão da puberdade para preservar o potencial de estatura final e adequar o desenvolvimento psicossocial.",
                    "Estímulo da produção de hormônio do crescimento."
                ],
                answer: 2,
                explanation: "O tratamento da PPC com análogos do GnRH tem como objetivos principais bloquear a progressão da puberdade, retardar a maturação óssea para preservar o potencial de altura final e minimizar os problemas psicossociais associados ao desenvolvimento sexual precoce.",
                topic: "Endocrinologia Pediátrica",
                reference: "Aula Puberdade Precoce, slide 13"
            },
            // Questão 20
            {
                id: 20,
                question: "20. Menino de 7 anos apresenta aparecimento de pelos pubianos na base do pênis e odor axilar característico. Não há aumento do volume testicular (<4ml) nem outros sinais de desenvolvimento puberal central. A velocidade de crescimento está discretamente aumentada e a idade óssea é 8 anos. Qual a variante benigna do desenvolvimento puberal mais provável?",
                options: [
                    "Telarca precoce isolada.",
                    "Puberdade precoce central idiopática.",
                    "Adrenarca precoce isolada.",
                    "Menarca precoce isolada."
                ],
                answer: 2,
                explanation: "A adrenarca precoce isolada é definida pelo aparecimento de pelos pubianos e/ou axilares, acne ou odor axilar antes dos 8 anos em meninas ou 9 anos em meninos, na ausência de outros sinais de ativação gonadal central (telarca ou aumento testicular). A velocidade de crescimento pode estar discretamente aumentada e a idade óssea pode ter um leve avanço.",
                topic: "Endocrinologia Pediátrica",
                reference: "Aula Puberdade Precoce, slide 19"
            },
            // Questão 21
            {
                id: 21,
                question: "21. Qual é o principal mecanismo fisiopatológico do Diabetes Mellitus tipo 1?",
                options: [
                    "Resistência periférica à ação da insulina.",
                    "Deficiência na produção de glucagon.",
                    "Destruição autoimune das células beta pancreáticas, levando à deficiência de insulina.",
                    "Aumento da secreção de hormônios contrarreguladores."
                ],
                answer: 2,
                explanation: "O DM tipo 1 é uma doença autoimune na qual o sistema imunológico do próprio indivíduo ataca e destrói as células beta produtoras de insulina nas ilhotas de Langerhans do pâncreas.",
                topic: "Diabetes Mellitus",
                reference: "Aula DM + CAD, slide 4"
            },
            // Questão 22
            {
                id: 22,
                question: "22. Na abordagem inicial da Cetoacidose Diabética (CAD) em crianças, após a expansão volêmica inicial, quando a glicemia atinge valores próximos a 250 mg/dL, qual alteração deve ser feita na solução de hidratação endovenosa?",
                options: [
                    "Manter SF 0,9% e aumentar a infusão de insulina.",
                    "Adicionar glicose à solução de hidratação (ex: ½ SG5% + ½ SF 0,9%).",
                    "Suspender a hidratação endovenosa e iniciar líquidos por via oral.",
                    "Trocar para Ringer Lactato e diminuir a infusão de insulina."
                ],
                answer: 1,
                explanation: "No tratamento da CAD, quando a glicemia capilar atinge valores em torno de 200-250 mg/dL, deve-se adicionar glicose (geralmente soro glicosado a 5%) à solução de hidratação endovenosa para evitar hipoglicemia, enquanto se mantém a infusão de insulina para corrigir a acidose e a cetose.",
                topic: "Cetoacidose Diabética",
                reference: "Aula DM + CAD, slide 52"
            },
            // Questão 23
            {
                id: 23,
                question: "23. Qual a principal célula envolvida na patogênese da urticária, responsável pela liberação de histamina e outros mediadores inflamatórios?",
                options: [
                    "Linfócito T.",
                    "Neutrófilo.",
                    "Mastócito.",
                    "Plaqueta."
                ],
                answer: 2,
                explanation: "Os mastócitos são células centrais na patogênese da urticária. Após ativação (imunológica ou não imunológica), eles degranulam, liberando histamina e outros mediadores inflamatórios que causam vasodilatação, aumento da permeabilidade vascular e prurido.",
                topic: "Alergologia",
                reference: "Aula Anafilaxia, slide 4 (inferido pela resposta à urticária)"
            },
            // Questão 24
            {
                id: 24,
                question: "24. Além da deficiência intelectual, qual das seguintes condições é uma comorbidade frequentemente encontrada em indivíduos com Síndrome de Down, requerendo acompanhamento específico?",
                options: [
                    "Hipertireoidismo autoimune (Doença de Graves).",
                    "Hipotireoidismo congênito ou adquirido.",
                    "Diabetes Mellitus tipo 1.",
                    "Doença de Addison."
                ],
                answer: 1,
                explanation: "Indivíduos com Síndrome de Down têm uma prevalência aumentada de disfunção tireoidiana, incluindo hipotireoidismo congênito e hipotireoidismo adquirido (geralmente de natureza autoimune, como a Tireoidite de Hashimoto).",
                topic: "Síndromes Genéticas",
                reference: "Aula Síndrome de Down, slide 8 (tabela)"
            },
            // Questão 25
            {
                id: 25,
                question: "25. Qual o mecanismo citogenético mais comum na Síndrome de Turner?",
                options: [
                    "Trissomia do cromossomo X (47,XXX).",
                    "Monossomia do cromossomo X (45,X).",
                    "Deleção do braço curto do cromossomo 5 (Síndrome de Cri-du-Chat).",
                    "Translocação Robertsoniana envolvendo o cromossomo X."
                ],
                answer: 1,
                explanation: "A Síndrome de Turner é causada pela ausência total ou parcial de um dos cromossomos X em indivíduos do sexo feminino. O cariótipo mais comum é 45,X. Linfedema de mãos e pés ao nascer é uma característica fenotípica comum.",
                topic: "Síndromes Genéticas",
                reference: "Aula Síndromes Baixa e Alta Estatura, slide 13"
            },
            // Questão 26
            {
                id: 26,
                question: "26. Na Síndrome de Klinefelter (47,XXY), qual é a principal consequência endocrinológica que se manifesta na puberdade ou vida adulta?",
                options: [
                    "Hipogonadismo hipergonadotrófico.",
                    "Hipogonadismo hipogonadotrófico.",
                    "Excesso de produção de testosterona.",
                    "Deficiência de hormônio do crescimento."
                ],
                answer: 0,
                explanation: "Na Síndrome de Klinefelter (47,XXY), ocorre disfunção testicular primária (falência gonadal), levando a baixos níveis de testosterona e, consequentemente, a níveis elevados de gonadotrofinas (LH e FSH) por ausência de feedback negativo. Isso caracteriza um hipogonadismo hipergonadotrófico.",
                topic: "Síndromes Genéticas",
                reference: "Aula Genitália Atípica, slide 24; Aula Síndromes Baixa e Alta Estatura, slide 21"
            },
            // Questão 27
            {
                id: 27,
                question: "27. Qual a principal via de transmissão do vírus da Rubéola e qual o período de maior transmissibilidade da doença?",
                options: [
                    "Via fecal-oral; durante todo o período febril.",
                    "Contato com lesões cutâneas; desde o surgimento do exantema até a resolução.",
                    "Secreções nasofaríngeas; de 5-7 dias antes até 5-7 dias após o início do exantema.",
                    "Vetores (mosquitos); durante os meses de verão."
                ],
                answer: 2,
                explanation: "A rubéola é transmitida principalmente por meio de gotículas de secreções nasofaríngeas de pessoas infectadas. O período de maior transmissibilidade ocorre de 5 a 7 dias antes do aparecimento do exantema e se estende por 5 a 7 dias após o seu início.",
                topic: "Infectologia Pediátrica",
                reference: "Doc Rubéola, pág. 5"
            },
            // Questão 28
            {
                id: 28,
                question: "28. No cálculo da área de superfície corporal queimada (SCQ) em crianças, qual o método considerado mais preciso por levar em conta as mudanças nas proporções corporais com a idade?",
                options: [
                    "Regra dos Nove de Wallace.",
                    "Diagrama de Lund-Browder.",
                    "Regra da Palma da Mão (considerando a palma da mão do paciente como 1%).",
                    "Estimativa visual global."
                ],
                answer: 1,
                explanation: "O diagrama de Lund-Browder é considerado o método mais preciso para estimar a SCQ em crianças, pois leva em consideração as variações das proporções corporais que ocorrem com o crescimento e desenvolvimento.",
                topic: "Queimaduras",
                reference: "Aula Queimaduras, slide 8"
            },
            // Questão 29
            {
                id: 29,
                question: "29. A triagem neonatal biológica (Teste do Pezinho) visa identificar precocemente doenças para as quais existem intervenções que modificam a história natural. Qual das seguintes doenças é detectada pela dosagem de 17-OH-progesterona?",
                options: [
                    "Fenilcetonúria.",
                    "Hipotireoidismo Congênito.",
                    "Fibrose Cística.",
                    "Hiperplasia Adrenal Congênita."
                ],
                answer: 3,
                explanation: "A triagem neonatal para Hiperplasia Adrenal Congênita (HAC) é realizada através da dosagem do hormônio 17-hidroxiprogesterona (17OHP) em amostra de sangue seco (papel filtro).",
                topic: "Triagem Neonatal",
                reference: "Aula Triagem Neonatal, slide 21"
            },
            // Questão 30
            {
                id: 30,
                question: "30. Qual a principal alteração cromossômica encontrada na Síndrome de Down?",
                options: [
                    "Trissomia do cromossomo 13.",
                    "Trissomia do cromossomo 18.",
                    "Trissomia do cromossomo 21.",
                    "Monossomia do cromossomo X."
                ],
                answer: 2,
                explanation: "A Síndrome de Down é causada pela presença de uma cópia extra do cromossomo 21, resultando em um total de três cópias deste cromossomo (trissomia do 21).",
                topic: "Síndromes Genéticas",
                reference: "Aula Síndrome de Down, slide 2-3"
            },
            // Questão 31
            {
                id: 31,
                question: "31. A Fibrose Cística é uma doença genética autossômica recessiva. Qual o teste padrão-ouro para confirmação diagnóstica após uma triagem neonatal positiva (IRT elevado)?",
                options: [
                    "Dosagem de cloreto no suor (teste do suor).",
                    "Estudo molecular do gene CFTR.",
                    "Prova de função pulmonar.",
                    "Elastase fecal."
                ],
                answer: 0,
                explanation: "O teste do suor, que mede a concentração de cloreto no suor, é o padrão-ouro para a confirmação diagnóstica da Fibrose Cística após uma triagem neonatal positiva (aumento da Tripsina Imunorreativa - IRT) ou em caso de suspeita clínica.",
                topic: "Triagem Neonatal / Genética",
                reference: "Aula Triagem Neonatal, slide 18 (inferido, pois IRT é para FC)"
            },
            // Questão 32
            {
                id: 32,
                question: "32. Na forma clássica virilizante simples da Hiperplasia Adrenal Congênita por deficiência da 21-hidroxilase, qual é a principal consequência da deficiência de aldosterona, que pode levar a uma crise perdedora de sal?",
                options: [
                    "Hipernatremia e hipocalemia.",
                    "Hiponatremia e hipercalemia.",
                    "Alcalose metabólica.",
                    "Hipertensão arterial."
                ],
                answer: 1,
                explanation: "Na forma perdedora de sal da HAC por deficiência de 21-hidroxilase, a deficiência de aldosterona leva à incapacidade dos rins de reter sódio e excretar potássio adequadamente. Isso resulta em hiponatremia (sódio baixo), hipercalemia (potássio alto), desidratação e hipotensão, podendo levar a uma crise adrenal potencialmente fatal.",
                topic: "Endocrinologia Pediátrica",
                reference: "Aula Triagem Neonatal, slide 23 (clínica da HAC)"
            },
            // Questão 33
            {
                id: 33,
                question: "33. Qual a principal via de transmissão do Citomegalovírus (CMV) da mãe para o feto, resultando em infecção congênita?",
                options: [
                    "Contato durante o parto vaginal.",
                    "Através do aleitamento materno.",
                    "Transplacentária.",
                    "Contato com secreções respiratórias maternas no pós-parto imediato."
                ],
                answer: 2,
                explanation: "A infecção congênita por CMV ocorre quando o vírus é transmitido da mãe para o feto através da placenta durante a gestação. Isso pode acontecer tanto em primoinfecção materna quanto em reativação ou reinfecção.",
                topic: "Infectologia Pediátrica",
                reference: "Aula Infecções Congênitas Herpes, pág. 228"
            },
            // Questão 34
            {
                id: 34,
                question: "34. Uma gestante não imune entra em contato com um caso de varicela. Qual a conduta profilática recomendada para a gestante, se a exposição for significativa, para reduzir o risco de doença grave materna?",
                options: [
                    "Vacinação imediata com a vacina contra varicela.",
                    "Administração de Aciclovir oral profilático por 7 dias.",
                    "Administração de Imunoglobulina humana antivaricela-zóster (VZIG ou VARIZIG) o mais breve possível (idealmente até 96 horas após exposição).",
                    "Apenas observação, pois o risco de complicações é baixo."
                ],
                answer: 2,
                explanation: "Para gestantes suscetíveis (não imunes) expostas à varicela, a administração de VZIG é recomendada para tentar prevenir ou atenuar a doença materna e, consequentemente, reduzir o risco de complicações para a mãe e o feto. A vacina é contraindicada na gestação.",
                topic: "Infectologia Pediátrica",
                reference: "Aula Infecções Congênitas Herpes, pág. 227 (Tabela 4)"
            },
            // Questão 35
            {
                id: 35,
                question: "35. A acondroplasia é a forma mais comum de nanismo desproporcional. Qual o tipo de encurtamento de membros característico desta condição?",
                options: [
                    "Rizomélico (encurtamento proximal dos membros - úmero e fêmur).",
                    "Mesomélico (encurtamento medial dos membros - rádio/ulna e tíbia/fíbula).",
                    "Acromélico (encurtamento distal dos membros - mãos e pés).",
                    "Generalizado e proporcional."
                ],
                answer: 0,
                explanation: "A acondroplasia é caracterizada por um encurtamento desproporcional dos membros, sendo o padrão rizomélico o mais evidente, afetando os segmentos proximais (braços e coxas).",
                topic: "Síndromes Genéticas / Baixa Estatura",
                reference: "Aula Baixa Estatura, slide 19; Aula Síndromes Baixa e Alta Estatura, slide 8"
            },
            // Questão 36
            {
                id: 36,
                question: "36. A Síndrome de Marfan é uma doença do tecido conjuntivo com herança autossômica dominante, causada por mutações no gene FBN1. Qual das seguintes manifestações NÃO é um critério maior ou sistêmico frequentemente associado à Síndrome de Marfan, segundo os critérios de Ghent revisados?",
                options: [
                    "Dilatação da raiz da aorta.",
                    "Ectopia lentis (deslocamento do cristalino).",
                    "Presença de múltiplas manchas café com leite.",
                    "Escoliose ou cifose significativa."
                ],
                answer: 2,
                explanation: "Dilatação da raiz da aorta, ectopia lentis e achados esqueléticos como escoliose são características importantes da Síndrome de Marfan. Múltiplas manchas café com leite são mais características de outras síndromes, como a Neurofibromatose tipo 1, e não são um critério diagnóstico primário para Marfan.",
                topic: "Síndromes Genéticas / Alta Estatura",
                reference: "Aula Síndromes Baixa e Alta Estatura, slides 22, 25, 26"
            },
            // Questão 37
            {
                id: 37,
                question: "37. Qual a importância do aconselhamento genético para famílias com histórico de doenças genéticas ou após o diagnóstico de uma condição genética em um membro da família?",
                options: [
                    "Garantir a cura da doença genética através de terapia gênica imediata.",
                    "Fornecer informações sobre a doença, o padrão de herança, riscos de recorrência, opções de teste e manejo, auxiliando na tomada de decisões.",
                    "Determinar a obrigatoriedade de testes genéticos para todos os membros da família.",
                    "Oferecer exclusivamente suporte psicológico, sem abordar aspectos médicos ou genéticos."
                ],
                answer: 1,
                explanation: "O aconselhamento genético é um processo de comunicação que visa ajudar indivíduos e famílias a compreender e se adaptar às implicações médicas, psicológicas e familiares de doenças genéticas. Ele inclui informações sobre diagnóstico, prognóstico, padrão de herança, risco de recorrência e opções de manejo e prevenção.",
                topic: "Genética Médica",
                reference: "Aula Atribuições APS Genética, slide 20; Aula Deficiência Intelectual, slide 42"
            },
            // Questão 38
            {
                id: 38,
                question: "38. Em crianças menores de 5 anos, o diagnóstico de Deficiência Intelectual (DI) é desafiador, pois testes de QI não são validados. Qual termo é utilizado para descrever crianças nesta faixa etária que não atingem os marcos do desenvolvimento esperados?",
                options: [
                    "Transtorno do Espectro Autista.",
                    "Atraso Global do Desenvolvimento ou Atraso do Desenvolvimento Neuropsicomotor.",
                    "Dislexia.",
                    "Transtorno de Déficit de Atenção e Hiperatividade (TDAH)."
                ],
                answer: 1,
                explanation: "Em crianças menores de 5 anos, quando a aplicação de testes de QI formais não é apropriada ou validada, o termo utilizado para descrever um atraso significativo em duas ou mais áreas do desenvolvimento (motor, linguagem, cognitivo, social-emocional, adaptativo) é Atraso Global do Desenvolvimento (AGD) ou Atraso do Desenvolvimento Neuropsicomotor (ADNPM).",
                topic: "Desenvolvimento Infantil / Deficiência Intelectual",
                reference: "Aula Deficiência Intelectual, slide 9"
            },
            // Questão 39
            {
                id: 39,
                question: "39. Um recém-nascido apresenta genitália atípica. O cariótipo é 46,XX e há virilização significativa da genitália externa (clitoromegalia, fusão labial). A dosagem de 17-OH-progesterona está muito elevada. Qual o diagnóstico mais provável para este Distúrbio do Desenvolvimento Sexual (DDS)?",
                options: [
                    "Síndrome de Insensibilidade Androgênica Completa.",
                    "Disgenesia Gonadal Completa 46,XY (Síndrome de Swyer).",
                    "Hiperplasia Adrenal Congênita por deficiência da 21-hidroxilase.",
                    "DDS Testicular 46,XX (SRY+)."
                ],
                answer: 2,
                explanation: "Em um indivíduo 46,XX com genitália ambígua virilizada e 17-OH-progesterona elevada, o diagnóstico mais provável é Hiperplasia Adrenal Congênita devido à deficiência da enzima 21-hidroxilase. Esta é a causa mais comum de genitália ambígua em recém-nascidos 46,XX.",
                topic: "Distúrbios do Desenvolvimento Sexual (DDS)",
                reference: "Aula Genitália Atípica, slide 13 (DDS 46,XX por excesso de androgênios)"
            },
            // Questão 40
            {
                id: 40,
                question: "40. Qual o principal tipo de imunodeficiência primária (IDP) que se manifesta com infecções sinopulmonares recorrentes por bactérias encapsuladas (como pneumococo e Haemophilus influenzae) e diarreia crônica por Giardia lamblia?",
                options: [
                    "Deficiências da fagocitose (ex: Doença Granulomatosa Crônica).",
                    "Deficiências do sistema complemento.",
                    "Imunodeficiências humorais (predominantemente de anticorpos/células B).",
                    "Imunodeficiências celulares (predominantemente de células T)."
                ],
                answer: 2,
                explanation: "As imunodeficiências humorais, que afetam a produção de anticorpos pelas células B e plasmócitos, predispõem classicamente a infecções por bactérias encapsuladas (como S. pneumoniae, H. influenzae) e infecções do trato gastrointestinal, como giardíase.",
                topic: "Imunodeficiências",
                reference: "Aula Imunodeficiência, slide 10"
            },
            // Questão 41
            {
                id: 41,
                question: "41. Uma criança apresenta duas ou mais pneumonias no último ano, quatro ou mais otites médias agudas no último ano e história familiar de imunodeficiência. Estes achados são considerados sinais de alerta para qual condição?",
                options: [
                    "Doença celíaca.",
                    "Fibrose cística.",
                    "Imunodeficiência primária.",
                    "Asma grave."
                ],
                answer: 2,
                explanation: "A combinação de infecções respiratórias recorrentes e graves (pneumonias, otites), especialmente se associada a uma história familiar de imunodeficiência ou outros sinais de alerta, levanta forte suspeita para uma imunodeficiência primária.",
                topic: "Imunodeficiências",
                reference: "Aula Imunodeficiência, slide 7 (Sinais de Alerta)"
            },
            // Questão 42
            {
                id: 42,
                question: "42. Qual o tipo de anomalia congênita que resulta de um processo de desenvolvimento intrinsecamente anormal de um órgão ou parte do corpo?",
                options: [
                    "Deformidade.",
                    "Disrupção.",
                    "Displasia.",
                    "Malformação."
                ],
                answer: 3,
                explanation: "Uma malformação é um defeito morfológico de um órgão, parte dele ou parte maior do corpo, que resulta de um processo de desenvolvimento intrinsecamente anormal. Ou seja, o potencial de desenvolvimento da estrutura já era anormal desde o início.",
                topic: "Anomalias Congênitas",
                reference: "Aula Anomalias Congênitas, slide 21"
            },
            // Questão 43
            {
                id: 43,
                question: "43. A exposição ao álcool durante a gestação é um conhecido agente teratogênico. Qual o período da gestação em que o sistema nervoso central do feto é particularmente vulnerável aos efeitos do álcool, podendo levar a alterações estruturais e funcionais graves?",
                options: [
                    "Apenas no terceiro trimestre.",
                    "Apenas durante o período periconcepcional.",
                    "Durante todo o período gestacional, mas com maior gravidade nas primeiras semanas (organogênese).",
                    "Apenas no momento do parto."
                ],
                answer: 2,
                explanation: "O sistema nervoso central é vulnerável aos efeitos teratogênicos do álcool durante toda a gestação. No entanto, a exposição durante o primeiro trimestre, período crítico da organogênese, está associada a malformações estruturais mais graves, incluindo as dismorfias faciais e defeitos cerebrais maiores. A exposição em trimestres posteriores pode levar a restrição de crescimento e problemas funcionais do SNC.",
                topic: "Teratogênese",
                reference: "Aula Anomalias Congênitas, slide 29; Aula Efeitos do Álcool RN, pág. 372"
            },
            // Questão 44
            {
                id: 44,
                question: "44. Qual a definição de \"Aleitamento Materno Predominante\"?",
                options: [
                    "A criança recebe somente leite materno, sem outros líquidos ou sólidos.",
                    "A criança recebe, além do leite materno, água ou bebidas à base de água (chás, sucos), mas não outro tipo de leite.",
                    "A criança recebe, além do leite materno, alimentos complementares sólidos ou semissólidos.",
                    "A criança recebe, além do leite materno, outros tipos de leite (fórmula infantil)."
                ],
                answer: 1,
                explanation: "Aleitamento Materno Predominante ocorre quando a criança recebe leite materno como principal fonte de alimento, mas também pode receber água, chás, sucos de frutas ou soluções de reidratação oral. Não inclui a oferta de outros tipos de leite (como fórmula infantil) ou alimentos sólidos/semissólidos.",
                topic: "Aleitamento Materno",
                reference: "Aula Aleitamento Materno, slide 19"
            },
            // Questão 45
            {
                id: 45,
                question: "45. A \"hora dourada\" refere-se à primeira hora de vida do bebê. Qual prática é fundamental e deve ser estimulada o mais precocemente possível neste período para promover o vínculo mãe-bebê e facilitar a amamentação?",
                options: [
                    "Banho imediato do recém-nascido.",
                    "Administração de vitamina K.",
                    "Contato pele a pele entre mãe e bebê.",
                    "Coleta do teste do pezinho."
                ],
                answer: 2,
                explanation: "O contato pele a pele imediato e contínuo entre a mãe e o recém-nascido na primeira hora de vida (hora dourada) é uma prática recomendada para promover o vínculo, estabilizar o bebê, facilitar o início da amamentação e reduzir o estresse neonatal.",
                topic: "Aleitamento Materno / Neonatologia",
                reference: "Aula Aleitamento Materno, slide 31"
            },
            // Questão 46
            {
                id: 46,
                question: "46. A apojadura, ou \"descida do leite\", geralmente ocorre entre o 3º e o 5º dia pós-parto. Qual mudança hormonal é crucial para o desencadeamento da lactogênese II (início da produção abundante de leite)?",
                options: [
                    "Aumento súbito dos níveis de estrogênio.",
                    "Redução dos níveis de progesterona após a expulsão da placenta, permitindo a ação da prolactina.",
                    "Pico de Hormônio Luteinizante (LH).",
                    "Aumento da secreção de cortisol materno."
                ],
                answer: 1,
                explanation: "Durante a gestação, altos níveis de progesterona inibem a produção abundante de leite, apesar dos níveis elevados de prolactina. Após o parto e a expulsão da placenta, os níveis de progesterona caem abruptamente, removendo essa inibição e permitindo que a prolactina estimule a lactogênese II, que é a produção de leite maduro em maior volume (apojadura).",
                topic: "Aleitamento Materno",
                reference: "Aula Aleitamento Materno, slide 41"
            },
            // Questão 47
            {
                id: 47,
                question: "47. Os primeiros mil dias de vida são cruciais para o desenvolvimento infantil. Qual o papel da microbiota intestinal estabelecida precocemente neste contexto?",
                options: [
                    "Exclusivamente digestão de alimentos complexos.",
                    "Programação do sistema imunológico, metabolismo e influência no eixo intestino-cérebro.",
                    "Produção de todos os hormônios de crescimento.",
                    "Determinação da cor dos olhos e tipo de cabelo."
                ],
                answer: 1,
                explanation: "A microbiota intestinal, estabelecida nos primeiros mil dias, desempenha um papel fundamental na maturação do sistema imunológico, no metabolismo de nutrientes, na proteção contra patógenos e na comunicação bidirecional com o cérebro (eixo intestino-cérebro), influenciando o desenvolvimento neurológico e comportamental.",
                topic: "Nutrição e Desenvolvimento Infantil",
                reference: "Aula Aleitamento Materno, slides 9-10"
            },
            // Questão 48
            {
                id: 48,
                question: "48. Qual o principal mecanismo pelo qual o aleitamento materno exclusivo protege o lactente contra infecções?",
                options: [
                    "Fornecimento de calorias e macronutrientes em proporções ideais.",
                    "Transferência de anticorpos maternos (principalmente IgA secretora), células de defesa e componentes bioativos que modulam a resposta imune.",
                    "Estímulo ao desenvolvimento da musculatura orofacial.",
                    "Presença de alta concentração de ferro de fácil absorção."
                ],
                answer: 1,
                explanation: "O leite materno é rico em fatores imunológicos, como IgA secretora (que protege as mucosas), lactoferrina, lisozima, leucócitos maternos e oligossacarídeos, que oferecem proteção passiva e ativa contra uma ampla gama de infecções.",
                topic: "Aleitamento Materno / Imunologia",
                reference: "Aula Aleitamento Materno, slide 20, 23"
            },
            // Questão 49
            {
                id: 49,
                question: "49. No manejo da crise de asma muito grave com risco de vida iminente, qual medida de suporte ventilatório pode ser considerada antes da intubação orotraqueal, se disponível e sem contraindicações?",
                options: [
                    "Oxigênio por cateter nasal em baixo fluxo.",
                    "Ventilação não invasiva (VNI) com CPAP ou BIPAP.",
                    "Nebulização contínua com soro fisiológico.",
                    "Fisioterapia respiratória com tapotagem."
                ],
                answer: 1,
                explanation: "Em crises de asma muito graves, a ventilação não invasiva (VNI) com pressão positiva contínua nas vias aéreas (CPAP) ou pressão positiva em dois níveis (BIPAP) pode ser utilizada para melhorar a ventilação, reduzir o trabalho respiratório e evitar a necessidade de intubação orotraqueal, desde que não haja contraindicações e o paciente esteja colaborativo ou sedado adequadamente.",
                topic: "Asma / Emergências Pediátricas",
                reference: "Aula Afecções VAI, slide 15; Doc. Terapia IRpA, pág. 5"
            },
            // Questão 50
            {
                id: 50,
                question: "50. Uma gestante com lesões herpéticas genitais ativas no momento do parto vaginal tem risco de transmitir o Herpes Simplex Vírus (HSV) para o recém-nascido. Qual a forma mais grave de HSV neonatal, associada a alta mortalidade e sequelas neurológicas?",
                options: [
                    "Doença localizada na pele, olhos e/ou boca (SEM).",
                    "Encefalite herpética.",
                    "Doença disseminada, com acometimento de múltiplos órgãos (fígado, pulmões, SNC).",
                    "Infecção assintomática com soroconversão."
                ],
                answer: 2,
                explanation: "A infecção neonatal por HSV pode se manifestar de três formas: doença localizada na pele, olhos e/ou boca (SEM); doença do sistema nervoso central (SNC), com ou sem envolvimento cutâneo; e doença disseminada. A doença disseminada envolve múltiplos órgãos e é a forma mais grave, com alta taxa de mortalidade mesmo com tratamento antiviral. A encefalite (opção B) também é grave, mas a doença disseminada (opção C) implica um acometimento sistêmico mais amplo e fulminante.",
                topic: "Infectologia Pediátrica / Neonatologia",
                reference: "Aula Infecções Congênitas Herpes, pág. 224"
            }
        ];

        // Elementos do DOM
        const quizContainer = document.getElementById('quizContainer');
        const scoreCounterEl = document.getElementById('scoreCounter');
        const answeredCounterEl = document.getElementById('answeredCounter');
        const totalQuestionsCounterEl = document.getElementById('totalQuestionsCounter');
        const visibleQuestionsCounterEl = document.getElementById('visibleQuestionsCounter');

        const studyModeBtn = document.getElementById('studyModeBtn');
        const examModeBtn = document.getElementById('examModeBtn');
        const topicFilter = document.getElementById('topicFilter');
        const searchInput = document.getElementById('searchInput');
        const themeToggleBtn = document.getElementById('themeToggleBtn');

        const examModeControls = document.getElementById('examModeControls');
        const numQuestionsExamInput = document.getElementById('numQuestionsExam');
        const navigationContainer = document.getElementById('navigationContainer');
        const prevQuestionBtn = document.getElementById('prevQuestionBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const timerEl = document.getElementById('timer');
        const examProgressContainer = document.getElementById('examProgress');
        const examProgressBar = document.getElementById('examProgressBar');
        const examSummaryContainer = document.getElementById('examSummaryContainer');
        const examScoreEl = document.getElementById('examScore');
        const examTotalEl = document.getElementById('examTotal');
        const examTimeSpentEl = document.getElementById('examTimeSpent');
        const reviewExamBtn = document.getElementById('reviewExamBtn');
        const retryIncorrectBtn = document.getElementById('retryIncorrectBtn');
        const restartExamBtn = document.getElementById('restartExamBtn');

        const historyModal = document.getElementById('historyModal');
        const historyListEl = document.getElementById('historyList');
        const showHistoryBtn = document.getElementById('showHistoryBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');


        // Estado do Quiz
        let currentMode = 'study'; // 'study' or 'exam'
        let currentQuestions = [...allQuestions]; // Array de questões atualmente visíveis/ativas
        let userAnswers = {}; // { questionId: { selectedOption: index, isCorrect: bool, marked: bool } }
        let correctAnswersCount = 0;
        let questionsAnsweredCount = 0;
        let currentExamQuestionIndex = 0;
        let examTimerInterval;
        let examSecondsElapsed = 0;
        let examIncorrectAnswers = [];
        let examQuestionsOrder = [];


        // --- Inicialização ---
        function initializeQuiz() {
            populateTopics();
            loadTheme();
            renderFilteredQuestions();
            updateScoreDisplay();

            studyModeBtn.addEventListener('click', () => switchMode('study'));
            examModeBtn.addEventListener('click', () => switchMode('exam'));
            topicFilter.addEventListener('change', renderFilteredQuestions);
            searchInput.addEventListener('input', renderFilteredQuestions);
            themeToggleBtn.addEventListener('click', toggleTheme);

            prevQuestionBtn.addEventListener('click', showPreviousExamQuestion);
            nextQuestionBtn.addEventListener('click', showNextExamQuestion);
            
            numQuestionsExamInput.addEventListener('change', () => {
                if (parseInt(numQuestionsExamInput.value) > allQuestions.length) {
                    numQuestionsExamInput.value = allQuestions.length;
                }
                if (parseInt(numQuestionsExamInput.value) < 1) {
                    numQuestionsExamInput.value = 1;
                }
            });
            
            reviewExamBtn.addEventListener('click', reviewExamAnswers);
            retryIncorrectBtn.addEventListener('click', startRetryIncorrectQuiz);
            restartExamBtn.addEventListener('click', () => switchMode('exam')); // Reinicia o modo simulado

            showHistoryBtn.addEventListener('click', () => {
                loadHistory();
                historyModal.style.display = 'block';
            });
            clearHistoryBtn.addEventListener('click', clearHistory);
        }

        function populateTopics() {
            const topics = [...new Set(allQuestions.map(q => q.topic))].sort();
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicFilter.appendChild(option);
            });
        }

        // --- Lógica de Modos ---
        function switchMode(mode) {
            currentMode = mode;
            userAnswers = {};
            correctAnswersCount = 0;
            questionsAnsweredCount = 0;
            currentExamQuestionIndex = 0;
            examIncorrectAnswers = [];
            examQuestionsOrder = [];
            stopExamTimer();
            timerEl.textContent = "Tempo: 00:00";


            if (mode === 'study') {
                studyModeBtn.classList.add('active');
                examModeBtn.classList.remove('active');
                examModeControls.style.display = 'none';
                navigationContainer.style.display = 'none';
                examProgressContainer.style.display = 'none';
                examSummaryContainer.style.display = 'none';
                topicFilter.disabled = false;
                searchInput.disabled = false;
                renderFilteredQuestions();
            } else { // exam mode
                examModeBtn.classList.add('active');
                studyModeBtn.classList.remove('active');
                examModeControls.style.display = 'block'; // Ou flex, dependendo do seu layout
                navigationContainer.style.display = 'flex';
                examProgressContainer.style.display = 'block';
                examSummaryContainer.style.display = 'none';
                topicFilter.value = 'all'; // Reset topic filter for exam
                searchInput.value = '';    // Reset search
                topicFilter.disabled = true;
                searchInput.disabled = true;
                startExam();
            }
            updateScoreDisplay();
        }

        // --- Renderização das Questões ---
        function renderFilteredQuestions() {
            const selectedTopic = topicFilter.value;
            const searchTerm = searchInput.value.toLowerCase();

            currentQuestions = allQuestions.filter(q => {
                const matchesTopic = selectedTopic === 'all' || q.topic === selectedTopic;
                const matchesSearch = q.question.toLowerCase().includes(searchTerm) ||
                                      q.options.some(opt => opt.toLowerCase().includes(searchTerm));
                return matchesTopic && matchesSearch;
            });
            renderQuestions(currentQuestions);
            updateScoreDisplay(); // Atualiza o total visível
        }
        
        function renderQuestions(questionsToRender, reviewMode = false, examAnswers = null) {
            quizContainer.innerHTML = '';
            visibleQuestionsCounterEl.textContent = questionsToRender.length;
            if (questionsToRender.length === 0) {
                quizContainer.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400">Nenhuma questão encontrada com os filtros aplicados.</p>';
                return;
            }

            questionsToRender.forEach((q, index) => {
                const originalQuestionIndex = allQuestions.findIndex(aq => aq.id === q.id); // Para manter o estado das respostas
                const questionBlock = document.createElement('div');
                questionBlock.classList.add('question-block');
                questionBlock.id = `question-block-${q.id}`;

                const questionHeader = document.createElement('div');
                questionHeader.classList.add('flex', 'justify-between', 'items-center', 'mb-1');
                
                const questionNumberEl = document.createElement('p');
                questionNumberEl.classList.add('text-gray-500', 'dark:text-gray-400', 'text-sm');
                questionNumberEl.innerHTML = `Questão <span class="font-semibold">${index + 1}</span> ${q.topic ? `<span class="ml-2 text-xs bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-200 py-0.5 px-1.5 rounded-full">${q.topic}</span>` : ''}`;
                questionHeader.appendChild(questionNumberEl);

                const markButton = document.createElement('button');
                markButton.classList.add('mark-btn', 'p-1', 'rounded-full', 'text-gray-400', 'dark:text-gray-500', 'hover:text-yellow-500', 'dark:hover:text-yellow-400');
                markButton.title = "Marcar questão";
                markButton.innerHTML = `<i class="far fa-bookmark"></i>`;
                markButton.dataset.questionId = q.id;
                if (userAnswers[q.id] && userAnswers[q.id].marked) {
                    markButton.classList.add('text-yellow-500', 'dark:text-yellow-400');
                    markButton.innerHTML = `<i class="fas fa-bookmark"></i>`;
                }
                markButton.addEventListener('click', () => toggleMarkQuestion(q.id, markButton));
                if (currentMode === 'exam' && !reviewMode) markButton.style.display = 'block'; // Show only in exam mode before summary
                else if (currentMode === 'study' || reviewMode) markButton.style.display = 'block';
                else markButton.style.display = 'none';

                questionHeader.appendChild(markButton);
                questionBlock.appendChild(questionHeader);


                const questionTextEl = document.createElement('p');
                questionTextEl.classList.add('text-lg', 'font-medium', 'mb-4', 'question-text');
                questionTextEl.textContent = q.question;
                questionBlock.appendChild(questionTextEl);

                if (q.reference) {
                    const referenceEl = document.createElement('p');
                    referenceEl.classList.add('text-xs', 'text-gray-400', 'dark:text-gray-500', 'mb-3', 'italic');
                    referenceEl.textContent = `Referência: ${q.reference}`;
                    questionBlock.appendChild(referenceEl);
                }

                const optionsGrid = document.createElement('div');
                optionsGrid.classList.add('options-grid', 'grid', 'grid-cols-1', 'gap-2');
                questionBlock.appendChild(optionsGrid);

                q.options.forEach((option, optionIndex) => {
                    const optionButton = document.createElement('button');
                    optionButton.type = 'button';
                    optionButton.classList.add('option-button');
                    optionButton.dataset.questionId = q.id;
                    optionButton.dataset.optionIndex = optionIndex;

                    const optionLetter = document.createElement('span');
                    optionLetter.classList.add('option-letter');
                    optionLetter.textContent = String.fromCharCode(65 + optionIndex);

                    const optionText = document.createElement('span');
                    optionText.classList.add('option-text');
                    optionText.textContent = option;

                    optionButton.appendChild(optionLetter);
                    optionButton.appendChild(optionText);
                    optionsGrid.appendChild(optionButton);

                    if (currentMode === 'study' || reviewMode) {
                        optionButton.addEventListener('click', handleStudyOptionClick);
                    } else { // exam mode
                        optionButton.addEventListener('click', handleExamOptionSelect);
                    }

                    if (reviewMode && examAnswers && examAnswers[q.id] !== undefined) {
                        optionButton.disabled = true;
                        if (optionIndex === q.answer) {
                            optionButton.classList.add('correct-option');
                        }
                        if (optionIndex === examAnswers[q.id].selectedOption && optionIndex !== q.answer) {
                            optionButton.classList.add('incorrect-option');
                        }
                    } else if (currentMode === 'study' && userAnswers[q.id] && userAnswers[q.id].selectedOption !== undefined) {
                        // Re-apply styles if question was already answered in study mode
                        optionButton.disabled = true;
                         if (optionIndex === q.answer) {
                            optionButton.classList.add('correct-option');
                        }
                        if (optionIndex === userAnswers[q.id].selectedOption && optionIndex !== q.answer) {
                            optionButton.classList.add('incorrect-option');
                        }
                    }
                });
                
                const solutionArea = document.createElement('div');
                solutionArea.classList.add('solution-area', 'mt-4', 'text-right');
                
                const toggleSolutionBtn = document.createElement('button');
                toggleSolutionBtn.classList.add('toggle-solution-btn', 'text-sm', 'text-blue-600', 'dark:text-blue-400', 'hover:text-blue-800', 'dark:hover:text-blue-200', 'py-1', 'px-3', 'border', 'border-blue-600', 'dark:border-blue-400', 'rounded-md');
                toggleSolutionBtn.textContent = 'Ver solução e comentários';
                toggleSolutionBtn.style.display = (currentMode === 'study' && userAnswers[q.id] && userAnswers[q.id].selectedOption !== undefined) || reviewMode ? 'inline-block' : 'none';
                toggleSolutionBtn.dataset.questionId = q.id;
                solutionArea.appendChild(toggleSolutionBtn);
                questionBlock.appendChild(solutionArea);

                const explanationBox = document.createElement('div');
                explanationBox.classList.add('explanation-box');
                explanationBox.style.display = 'none';
                explanationBox.innerHTML = `<p class="font-semibold text-gray-700 dark:text-gray-200">Comentário:</p><p class="text-gray-600 dark:text-gray-300">${q.explanation}</p>`;
                questionBlock.appendChild(explanationBox);
                
                toggleSolutionBtn.addEventListener('click', () => {
                    const currentExplanationBox = questionBlock.querySelector('.explanation-box');
                    if (currentExplanationBox.style.display === 'none') {
                        currentExplanationBox.style.display = 'block';
                        toggleSolutionBtn.textContent = 'Ocultar solução e comentários';
                    } else {
                        currentExplanationBox.style.display = 'none';
                        toggleSolutionBtn.textContent = 'Ver solução e comentários';
                    }
                });
                quizContainer.appendChild(questionBlock);
            });
        }

        // --- Lógica de Resposta (Modo Estudo) ---
        function handleStudyOptionClick(event) {
            const selectedButton = event.currentTarget;
            const questionId = parseInt(selectedButton.dataset.questionId);
            const optionIndex = parseInt(selectedButton.dataset.optionIndex);
            const questionData = allQuestions.find(q => q.id === questionId);

            if (!userAnswers[questionId] || userAnswers[questionId].selectedOption === undefined) {
                questionsAnsweredCount++;
                userAnswers[questionId] = { ...userAnswers[questionId], selectedOption: optionIndex };

                const isCorrect = optionIndex === questionData.answer;
                userAnswers[questionId].isCorrect = isCorrect;
                if (isCorrect) {
                    correctAnswersCount++;
                }

                const parentOptionsGrid = selectedButton.parentElement;
                parentOptionsGrid.querySelectorAll('.option-button').forEach(btn => {
                    btn.disabled = true;
                    const optIdx = parseInt(btn.dataset.optionIndex);
                    if (optIdx === questionData.answer) {
                        btn.classList.add('correct-option');
                    } else if (optIdx === optionIndex) {
                        btn.classList.add('incorrect-option');
                    }
                });
                
                const questionBlock = selectedButton.closest('.question-block');
                const solutionButton = questionBlock.querySelector('.toggle-solution-btn');
                if(solutionButton) solutionButton.style.display = 'inline-block';
                
                updateScoreDisplay();
            }
        }

        // --- Lógica do Modo Simulado ---
        function startExam() {
            const numQuestions = parseInt(numQuestionsExamInput.value) || 10;
            // Shuffle allQuestions and take 'numQuestions'
            examQuestionsOrder = allQuestions.map(q => q.id).sort(() => 0.5 - Math.random()).slice(0, numQuestions);
            currentQuestions = examQuestionsOrder.map(id => allQuestions.find(q => q.id === id));
            
            userAnswers = {}; // Reset answers for the exam
            correctAnswersCount = 0;
            questionsAnsweredCount = 0; // This will track answers within the exam
            currentExamQuestionIndex = 0;
            examIncorrectAnswers = [];

            renderExamQuestion();
            startExamTimer();
            updateExamProgress();
            examSummaryContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            navigationContainer.style.display = 'flex';
            examProgressContainer.style.display = 'block';
        }

        function renderExamQuestion() {
            quizContainer.innerHTML = ''; // Clear previous question
            if (currentExamQuestionIndex >= currentQuestions.length) {
                finishExam();
                return;
            }
            const q = currentQuestions[currentExamQuestionIndex];
            renderQuestions([q]); // Render just the current question

            // Restore selected answer if any
            const questionBlock = document.getElementById(`question-block-${q.id}`);
            const optionsGrid = questionBlock.querySelector('.options-grid');
            if (userAnswers[q.id] && userAnswers[q.id].selectedOption !== undefined) {
                const selectedBtn = optionsGrid.children[userAnswers[q.id].selectedOption];
                if (selectedBtn) {
                    selectedBtn.classList.add('bg-blue-200', 'dark:bg-blue-700', 'border-blue-500', 'dark:border-blue-400');
                }
            }
             // Hide solution button and explanation in exam mode
            questionBlock.querySelector('.toggle-solution-btn').style.display = 'none';
            questionBlock.querySelector('.explanation-box').style.display = 'none';
        }
        
        function handleExamOptionSelect(event) {
            const selectedButton = event.currentTarget;
            const questionId = parseInt(selectedButton.dataset.questionId);
            const optionIndex = parseInt(selectedButton.dataset.optionIndex);

            // Remove previous selection style for this question
            const parentOptionsGrid = selectedButton.parentElement;
            parentOptionsGrid.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('bg-blue-200', 'dark:bg-blue-700', 'border-blue-500', 'dark:border-blue-400');
            });
            // Apply new selection style
            selectedButton.classList.add('bg-blue-200', 'dark:bg-blue-700', 'border-blue-500', 'dark:border-blue-400');

            if (!userAnswers[questionId] || userAnswers[questionId].selectedOption === undefined) {
                 questionsAnsweredCount++; // Count only first time answering this question in this exam attempt
            }
            userAnswers[questionId] = { ...userAnswers[questionId], selectedOption: optionIndex };
            updateExamProgress(); // Update progress bar based on actual answers
        }

        function showNextExamQuestion() {
            if (currentExamQuestionIndex < currentQuestions.length - 1) {
                currentExamQuestionIndex++;
                renderExamQuestion();
            } else if (currentExamQuestionIndex === currentQuestions.length -1) {
                // Optionally, auto-submit or show a "Finish" button instead of "Next"
                finishExam();
            }
            updateExamProgress();
        }

        function showPreviousExamQuestion() {
            if (currentExamQuestionIndex > 0) {
                currentExamQuestionIndex--;
                renderExamQuestion();
            }
            updateExamProgress();
        }
        
        function updateExamProgress() {
            const progress = (questionsAnsweredCount / currentQuestions.length) * 100;
            examProgressBar.style.width = `${progress}%`;
            prevQuestionBtn.disabled = currentExamQuestionIndex === 0;
            nextQuestionBtn.textContent = (currentExamQuestionIndex === currentQuestions.length - 1) ? 'Finalizar Simulado' : 'Próxima';
            nextQuestionBtn.classList.toggle('bg-green-500', currentExamQuestionIndex === currentQuestions.length - 1);
            nextQuestionBtn.classList.toggle('hover:bg-green-600', currentExamQuestionIndex === currentQuestions.length - 1);
        }

        function startExamTimer() {
            examSecondsElapsed = 0;
            timerEl.textContent = formatTime(examSecondsElapsed);
            examTimerInterval = setInterval(() => {
                examSecondsElapsed++;
                timerEl.textContent = formatTime(examSecondsElapsed);
            }, 1000);
        }

        function stopExamTimer() {
            clearInterval(examTimerInterval);
        }

        function formatTime(totalSeconds) {
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `Tempo: ${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function finishExam() {
            stopExamTimer();
            let score = 0;
            examIncorrectAnswers = [];
            currentQuestions.forEach(q => {
                if (userAnswers[q.id] && userAnswers[q.id].selectedOption === q.answer) {
                    score++;
                    userAnswers[q.id].isCorrect = true;
                } else {
                    userAnswers[q.id] = { ...userAnswers[q.id], isCorrect: false};
                    examIncorrectAnswers.push(q.id);
                }
            });

            examScoreEl.textContent = score;
            examTotalEl.textContent = currentQuestions.length;
            examTimeSpentEl.textContent = formatTime(examSecondsElapsed).replace('Tempo: ', '');
            
            quizContainer.style.display = 'none';
            navigationContainer.style.display = 'none';
            examProgressContainer.style.display = 'none';
            examSummaryContainer.style.display = 'block';

            saveHistory(score, currentQuestions.length, examSecondsElapsed, topicFilter.value === 'all' ? 'Todos' : topicFilter.value);
        }
        
        function reviewExamAnswers() {
            quizContainer.innerHTML = ''; // Clear current content
            renderQuestions(currentQuestions, true, userAnswers); // reviewMode = true, pass exam answers
            quizContainer.style.display = 'block';
            examSummaryContainer.style.display = 'none'; // Hide summary while reviewing
            // Scroll to top of quiz
             quizContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function startRetryIncorrectQuiz() {
            if (examIncorrectAnswers.length === 0) {
                alert("Parabéns, você acertou todas as questões do último simulado!");
                return;
            }
            currentQuestions = examIncorrectAnswers.map(id => allQuestions.find(q => q.id === id));
            // Reset for the new mini-exam
            userAnswers = {};
            correctAnswersCount = 0;
            questionsAnsweredCount = 0;
            currentExamQuestionIndex = 0;
            examIncorrectAnswers = []; // Clear for this new attempt

            renderExamQuestion();
            startExamTimer();
            updateExamProgress();
            examSummaryContainer.style.display = 'none';
            quizContainer.style.display = 'block';
            navigationContainer.style.display = 'flex';
            examProgressContainer.style.display = 'block';
        }


        // --- Marcar Questão ---
        function toggleMarkQuestion(questionId, button) {
            if (!userAnswers[questionId]) {
                userAnswers[questionId] = { selectedOption: undefined, isCorrect: undefined, marked: false };
            }
            userAnswers[questionId].marked = !userAnswers[questionId].marked;
            if (userAnswers[questionId].marked) {
                button.classList.add('text-yellow-500', 'dark:text-yellow-400');
                button.innerHTML = `<i class="fas fa-bookmark"></i>`;
                button.title = "Desmarcar questão";
            } else {
                button.classList.remove('text-yellow-500', 'dark:text-yellow-400');
                button.innerHTML = `<i class="far fa-bookmark"></i>`;
                button.title = "Marcar questão";
            }
            // No modo estudo, poderíamos adicionar a questão marcada a uma lista de revisão
            // No modo simulado, isso pode ser usado para navegação ou destaque no resumo
        }

        // --- Tema Claro/Escuro ---
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
            updateThemeButtonIcon(isDarkMode);
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                updateThemeButtonIcon(true);
            } else {
                 updateThemeButtonIcon(false); // Default to light
            }
        }
        function updateThemeButtonIcon(isDarkMode) {
            const moonIcon = themeToggleBtn.querySelector('.fa-moon');
            const sunIcon = themeToggleBtn.querySelector('.fa-sun');
            if (isDarkMode) {
                moonIcon.style.display = 'none';
                sunIcon.style.display = 'inline-block';
            } else {
                moonIcon.style.display = 'inline-block';
                sunIcon.style.display = 'none';
            }
        }

        // --- Histórico (localStorage) ---
        function saveHistory(score, total, time, topic) {
            const history = JSON.parse(localStorage.getItem('quizHistory')) || [];
            const attempt = {
                date: new Date().toLocaleString('pt-BR'),
                score: score,
                total: total,
                time: formatTime(time).replace('Tempo: ', ''),
                topic: topic,
                timestamp: Date.now() // for sorting
            };
            history.push(attempt);
            localStorage.setItem('quizHistory', JSON.stringify(history));
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('quizHistory')) || [];
            history.sort((a,b) => b.timestamp - a.timestamp); // Sort by most recent
            historyListEl.innerHTML = '';
            if (history.length === 0) {
                historyListEl.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Nenhum histórico de simulado encontrado.</p>';
                return;
            }
            const ul = document.createElement('ul');
            ul.classList.add('list-disc', 'pl-5', 'space-y-2');
            history.forEach(attempt => {
                const li = document.createElement('li');
                li.classList.add('text-sm', 'text-gray-700', 'dark:text-gray-300');
                li.textContent = `${attempt.date} - Tópico: ${attempt.topic} - Pontuação: ${attempt.score}/${attempt.total} - Tempo: ${attempt.time}`;
                ul.appendChild(li);
            });
            historyListEl.appendChild(ul);
        }
        
        function clearHistory() {
            if (confirm("Tem certeza que deseja limpar todo o histórico de simulados? Esta ação não pode ser desfeita.")) {
                localStorage.removeItem('quizHistory');
                loadHistory(); // Recarrega a lista vazia
            }
        }


        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', initializeQuiz);

    </script>
</body>
</html>

